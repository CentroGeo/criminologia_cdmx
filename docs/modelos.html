---

title: modelos


keywords: fastai
sidebar: home_sidebar

summary: "Herramientas de ajuste, validación y evaluación de modelos"
description: "Herramientas de ajuste, validación y evaluación de modelos"
nb_path: "03_modelos.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_modelos.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="variable_dependiente">variable_dependiente<a class="anchor-link" href="#variable_dependiente"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="variable_dependiente" class="doc_header"><code>variable_dependiente</code><a href="https://github.CentroGeo.com/criminologia_cdmx/criminologia_cdmx/tree/master/criminologia_cdmx/modelos.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>variable_dependiente</code>(<strong><code>datos</code></strong>, <strong><code>columna_y</code></strong>, <strong><code>valores_y</code></strong>, <strong><code>fecha_inicio</code></strong>, <strong><code>fecha_fin</code></strong>, <strong><code>agregacion</code></strong>=<em><code>'colonias'</code></em>, <strong><code>nombre_y</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Regresa un DataFrame con la variable independicente agregada entre fecha_inicio y fecha_fin
en las unidades requeridas.</p>
<p>Args:
    datos (DataFrame): carpetas/victimas con ids espaciales y categorías de usuario
    columna_y (str): Nombre de la columna en donde vienen los incidentes de valor_y
    valores_y (list): delitos o categorías a utilizar como Y
    fecha_inicio (str): fecha inicial para agregar delitos "d-m-Y"
    fecha_fin (str): fecha final para agregar delitos "d-m-Y"
    agregacion (str): colonias/cuadrantes. Eventualmente debe recibir
                      agregaciones arbitrarias (opcional)
    nombre_y (str): Nombre para la columna con la variable dependiente
                   (opcional, si se omite se concatenan los nombres de valores_y).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">carpetas</span> <span class="o">=</span> <span class="n">get_carpetas_from_api</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">carpetas</span> <span class="o">=</span> <span class="n">agrega_ids_espaciales</span><span class="p">(</span><span class="n">carpetas</span><span class="p">)</span>
<span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">carpetas</span><span class="o">.</span><span class="n">fecha_hechos</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m.%Y&quot;</span><span class="p">)</span>
<span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">carpetas</span><span class="o">.</span><span class="n">fecha_hechos</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m.%Y&quot;</span><span class="p">)</span>
<span class="c1"># Prueba con un delito</span>
<span class="n">delito</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ROBO A CASA HABITACION SIN VIOLENCIA&#39;</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">variable_dependiente</span><span class="p">(</span><span class="n">carpetas</span><span class="p">,</span> <span class="s1">&#39;delito&#39;</span><span class="p">,</span> <span class="n">delito</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_fin</span><span class="p">,</span> 
                           <span class="n">agregacion</span><span class="o">=</span><span class="s1">&#39;cuadrantes&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">delito</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Y</span><span class="o">.</span><span class="n">columns</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">variable_dependiente</span><span class="p">(</span><span class="n">carpetas</span><span class="p">,</span> <span class="s1">&#39;delito&#39;</span><span class="p">,</span> <span class="n">delito</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_fin</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">delito</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Y</span><span class="o">.</span><span class="n">columns</span>
<span class="c1"># Prueba con dos delitos y nombre de columna</span>
<span class="n">delitos</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ROBO A CASA HABITACION SIN VIOLENCIA&#39;</span><span class="p">,</span> <span class="s1">&#39;ROBO A CASA HABITACION CON VIOLENCIA&#39;</span><span class="p">]</span>
<span class="n">nombre_y</span> <span class="o">=</span> <span class="s2">&quot;Robo a Casa habitación (CV/SV)&quot;</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">variable_dependiente</span><span class="p">(</span><span class="n">carpetas</span><span class="p">,</span> <span class="s1">&#39;delito&#39;</span><span class="p">,</span> <span class="n">delitos</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_fin</span><span class="p">,</span> 
                           <span class="n">agregacion</span><span class="o">=</span><span class="s1">&#39;cuadrantes&#39;</span><span class="p">,</span> <span class="n">nombre_y</span><span class="o">=</span><span class="n">nombre_y</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">nombre_y</span> <span class="ow">in</span> <span class="n">Y</span><span class="o">.</span><span class="n">columns</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">variable_dependiente</span><span class="p">(</span><span class="n">carpetas</span><span class="p">,</span> <span class="s1">&#39;delito&#39;</span><span class="p">,</span> <span class="n">delitos</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">fecha_fin</span><span class="p">,</span> 
                           <span class="n">nombre_y</span><span class="o">=</span><span class="n">nombre_y</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">nombre_y</span> <span class="ow">in</span> <span class="n">Y</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CapaDeAnalisis">CapaDeAnalisis<a class="anchor-link" href="#CapaDeAnalisis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CapaDeAnalisis" class="doc_header"><code>class</code> <code>CapaDeAnalisis</code><a href="https://github.CentroGeo.com/criminologia_cdmx/criminologia_cdmx/tree/master/criminologia_cdmx/modelos.py#L68" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CapaDeAnalisis</code>(<strong><code>Y</code></strong>, <strong><code>covariables</code></strong>, <strong><code>agregacion</code></strong>=<em><code>'colonias'</code></em>)</p>
</blockquote>
<p>Clase para contener variable objetivo y covariables.</p>
<p>Args:
    Y (DataFrame): debe tener dos columnas: el identificador de la unidad de análisis y
                   el valor de la variable dependiente
                   (las columnas deben venir en ese orden).
    covariables (DataFrame): debe contener una columna con el identificador de la unidad
                             de análisis (común a Y) y tantas como covariables.
    agregación (str): colonias/cuadrantes.
Atributos:
    Y (DataFrame): la variable dependiente.
    Y_nombre (str): Nombre de la columna con el delito a modelar.
    X (DataFrame): las variables independientes.
    X_nombres (list): Lista de los nombres de columnas de las covariables.
    agregacion (str): colonias/cuadrantes.
    campo_id (str): el nombre del campo común en X y Y para unirlos.
    df (DataFrame): la unión de los dos X y Y.
    geo (GeoDataFrame): la unión de df con las geometrias que corresponden a <code>agregacion</code>
    w (libpysal.weights.Queen): Matriz de vecindad para los datos válidos</p>
<p><strong>NOTAS:</strong>
    1) El DataFrame con los datos finales va a contener sólo las observaciones válidas
    (sin nulos en Y o X), además, para poder hacer análisis espaciales, se eliminan los
    polígonos isla. Este DataFrame se guarda en self.df y es el que se debe usar para
    cualquier análisis</p>

<pre><code>2) Por lo pronto la clase calcula automáticamente una matriz de vecindad para los
datos, en el futuro esto debe cambiar para permitir al usuario definir su propia matriz.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">usos</span> <span class="o">=</span> <span class="n">get_uso_de_suelo</span><span class="p">()</span>
<span class="n">usos</span> <span class="o">=</span> <span class="n">agrega_uso_suelo</span><span class="p">(</span><span class="n">usos</span><span class="p">,</span> <span class="n">unidades</span><span class="o">=</span><span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="c1"># Crea la capa</span>
<span class="n">ca</span> <span class="o">=</span> <span class="n">CapaDeAnalisis</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">usos</span><span class="p">,</span> <span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="c1"># Pruebas de consistencia</span>
<span class="k">assert</span> <span class="n">ca</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">usos</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ca</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">ca</span><span class="o">.</span><span class="n">describe_Y</span><span class="p">())</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="k">assert</span> <span class="n">ca</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ca</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Prueba retraso espacial</span>
<span class="n">ca</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">retraso_x</span><span class="p">(</span><span class="s1">&#39;Intensidad&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;Intensidad_lag&#39;</span> <span class="ow">in</span> <span class="n">ca</span><span class="o">.</span>
<span class="c1"># TODO: pruebas a las gráficas</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">usos</span> <span class="o">=</span> <span class="n">get_uso_de_suelo</span><span class="p">()</span>
<span class="n">usos</span> <span class="o">=</span> <span class="n">agrega_uso_suelo</span><span class="p">(</span><span class="n">usos</span><span class="p">,</span> <span class="n">unidades</span><span class="o">=</span><span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="n">ca</span> <span class="o">=</span> <span class="n">CapaDeAnalisis</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">usos</span><span class="p">,</span> <span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="n">ca</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">retraso_x</span><span class="p">(</span><span class="s1">&#39;Intensidad&#39;</span><span class="p">)</span>
<span class="n">ca</span><span class="o">.</span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>colonia_cve</th>
      <th>Robo a Casa habitación (CV/SV)</th>
      <th>Industria</th>
      <th>Comercio</th>
      <th>Servicios</th>
      <th>Intensidad</th>
      <th>Entropía</th>
      <th>Intensidad_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>619</td>
      <td>2.0</td>
      <td>12</td>
      <td>53</td>
      <td>86</td>
      <td>151</td>
      <td>-3.770478</td>
      <td>341.800000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1792</td>
      <td>0.0</td>
      <td>5</td>
      <td>36</td>
      <td>40</td>
      <td>81</td>
      <td>-3.915404</td>
      <td>619.500000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1774</td>
      <td>0.0</td>
      <td>3</td>
      <td>16</td>
      <td>16</td>
      <td>35</td>
      <td>-3.661214</td>
      <td>217.400000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>583</td>
      <td>2.0</td>
      <td>31</td>
      <td>107</td>
      <td>241</td>
      <td>379</td>
      <td>-3.842116</td>
      <td>528.600000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1754</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.000000</td>
      <td>862.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1804</th>
      <td>1820</td>
      <td>0.0</td>
      <td>45</td>
      <td>255</td>
      <td>213</td>
      <td>513</td>
      <td>-3.651524</td>
      <td>353.000000</td>
    </tr>
    <tr>
      <th>1805</th>
      <td>1731</td>
      <td>3.0</td>
      <td>94</td>
      <td>474</td>
      <td>304</td>
      <td>872</td>
      <td>-3.541594</td>
      <td>428.500000</td>
    </tr>
    <tr>
      <th>1806</th>
      <td>1799</td>
      <td>0.0</td>
      <td>47</td>
      <td>229</td>
      <td>130</td>
      <td>406</td>
      <td>-3.520492</td>
      <td>293.125000</td>
    </tr>
    <tr>
      <th>1807</th>
      <td>1800</td>
      <td>1.0</td>
      <td>34</td>
      <td>207</td>
      <td>168</td>
      <td>409</td>
      <td>-3.693844</td>
      <td>376.666667</td>
    </tr>
    <tr>
      <th>1808</th>
      <td>1824</td>
      <td>0.0</td>
      <td>6</td>
      <td>24</td>
      <td>25</td>
      <td>55</td>
      <td>-3.489230</td>
      <td>532.500000</td>
    </tr>
  </tbody>
</table>
<p>1619 rows × 8 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ModeloGLM">ModeloGLM<a class="anchor-link" href="#ModeloGLM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModeloGLM" class="doc_header"><code>class</code> <code>ModeloGLM</code><a href="https://github.CentroGeo.com/criminologia_cdmx/criminologia_cdmx/tree/master/criminologia_cdmx/modelos.py#L247" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModeloGLM</code>(<strong><code>capa</code></strong>, <strong><code>familia</code></strong>, <strong><code>nombre</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Wrapper para modelos de Regresión GLM de statsmodels.</p>
<p>La clase prepara y ajusta un modelo GLM usando la variable objetivo
definida en CapaDeAnalisis y <strong>todas</strong> las covariables.</p>
<p>Args:
    capa (CapaDeAnalisis): objeto con las variables del modelo.
    familia (statsmodels.api.families.Family()) la distribución a usar en el modelo GLM.
    nombre (str): si no es nulo, el nombre, si no, se asigna nombre al azar.</p>
<p>Atributos:
    capa (CapaDeAnalisis): objeto con las variables del modelo.
    familia (statsmodels.api.families.Family()) la distribución a usar en el modelo GLM.
    formula (str): la fórmula usada para ajustar el modelo.
    df_resultado (DataFrame): los resultados como DataFrame.
    df_diagnostico (DataFrame): los diagnósticos como DataFrame.
    nombre (str): nombre que identifica al modelo.
Métodos:
    fit(): Ajusta el modelo.
    grafica_de_ajuste(): regresa la gráfica de ajuste.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ModeloGLM</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">NegativeBinomial</span><span class="p">())</span>
<span class="n">fm</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">df_resultado</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">df_diagnostico</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ComparaModelos">ComparaModelos<a class="anchor-link" href="#ComparaModelos"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ComparaModelos" class="doc_header"><code>class</code> <code>ComparaModelos</code><a href="https://github.CentroGeo.com/criminologia_cdmx/criminologia_cdmx/tree/master/criminologia_cdmx/modelos.py#L484" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ComparaModelos</code>(<strong><code>modelos</code></strong>, <strong><code>columnas</code></strong>=<em><code>None</code></em>, <strong><code>redondeo</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Clase para construir comparaciones de modelos.
Construte dos DataFrames para visualizar rápidamente una comparación de los modelos:
uno con los resultados (coeficientes, etc) y otro con los diagnósticos.
Args:
    modelos (list): Lista de modelos a comparar
    columnas (list): Lista de columnas que aparecen en la comparación de resultados
                     (opcional, default None)
    redondeo: (int): Decimales a usar en la comparaciónn (opcional, default None)
Atributos:
    modelos (list): Lista de modelos a comparar
    comparacion (DataFrame): comparación de los resultados</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">diccionario</span> <span class="o">=</span> <span class="n">get_diccionario_censo</span><span class="p">()</span>
<span class="n">censo</span> <span class="o">=</span> <span class="n">get_variables_censo</span><span class="p">()</span>
<span class="n">agregado</span> <span class="o">=</span> <span class="n">agrega_en_unidades</span><span class="p">(</span><span class="n">censo</span><span class="p">,</span> <span class="n">diccionario</span><span class="p">)</span>
<span class="n">agregado</span> <span class="o">=</span> <span class="n">censo_a_tasas</span><span class="p">(</span><span class="n">agregado</span><span class="p">,</span> <span class="n">diccionario</span><span class="p">)</span>
<span class="n">vars_viv</span> <span class="o">=</span> <span class="n">agregado</span><span class="p">[[</span><span class="s1">&#39;VIVPAR_HAB&#39;</span><span class="p">,</span> <span class="s1">&#39;VPH_3YMASC&#39;</span><span class="p">]]</span>
<span class="n">vars_indice</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P5_HLI&#39;</span><span class="p">,</span> <span class="s1">&#39;POB_AFRO&#39;</span><span class="p">,</span> <span class="s1">&#39;PCON_DISC&#39;</span><span class="p">,</span> <span class="s1">&#39;P3A5_NOA&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;P6A11_NOA&#39;</span><span class="p">,</span> <span class="s1">&#39;P12A14NOA&#39;</span><span class="p">,</span> <span class="s1">&#39;P15YM_AN&#39;</span><span class="p">,</span> <span class="s1">&#39;PSINDER&#39;</span><span class="p">,</span> <span class="s1">&#39;PDESOCUP&#39;</span><span class="p">]</span>
<span class="n">indice</span> <span class="o">=</span> <span class="n">IndicePCA</span><span class="p">(</span><span class="n">agregado</span><span class="p">,</span> <span class="n">vars_indice</span><span class="p">)</span>
<span class="n">indice</span><span class="o">.</span><span class="n">calcula_indice</span><span class="p">()</span>
<span class="n">var_m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">vars_viv</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indice</span><span class="o">.</span><span class="n">indice</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;colonia_cve&#39;</span><span class="p">))</span>
          <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Índice&#39;</span><span class="p">:</span> <span class="s1">&#39;Concentración de Desventajas&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">usos</span> <span class="o">=</span> <span class="n">get_uso_de_suelo</span><span class="p">()</span>
<span class="n">usos</span> <span class="o">=</span> <span class="n">agrega_uso_suelo</span><span class="p">(</span><span class="n">usos</span><span class="p">,</span> <span class="n">unidades</span><span class="o">=</span><span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="n">var_m2</span> <span class="o">=</span> <span class="n">var_m1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">usos</span><span class="p">)</span>
<span class="c1"># Dos capas de análisis</span>
<span class="n">ca1</span> <span class="o">=</span> <span class="n">CapaDeAnalisis</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">var_m1</span><span class="p">,</span> <span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="n">ca2</span> <span class="o">=</span> <span class="n">CapaDeAnalisis</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">var_m2</span><span class="p">,</span> <span class="s1">&#39;colonias&#39;</span><span class="p">)</span>
<span class="c1"># Ajustamos modelos</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">ModeloGLM</span><span class="p">(</span><span class="n">ca1</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">NegativeBinomial</span><span class="p">(),</span><span class="s2">&quot;nulo&quot;</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">ModeloGLM</span><span class="p">(</span><span class="n">ca2</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">NegativeBinomial</span><span class="p">(),</span> <span class="s2">&quot;uso de suelo&quot;</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># Probamos la comparacion</span>
<span class="n">compara</span> <span class="o">=</span> <span class="n">ComparaModelos</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">compara</span><span class="o">.</span><span class="n">comparacion</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">compara</span><span class="o">.</span><span class="n">diagnosticos</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">compara</span> <span class="o">=</span> <span class="n">ComparaModelos</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;P&gt;|z|&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">compara</span><span class="o">.</span><span class="n">comparacion</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">compara</span><span class="o">.</span><span class="n">diagnosticos</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

